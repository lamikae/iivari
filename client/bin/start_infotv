#!/bin/bash
# USAGE:
#   start_infotv URLBASE [--repl]
#
# Set URLBASE as the first parameter.
# Add --repl as second parameter to enter interactive JavaScript console.

export DISPLAY=:0.0

xset s reset
xset s 0 0
xset s off
xset s noblank
xset dpms 0 0 0
xset -dpms
xset dpms force on

metacity &
unclutter -idle 1 -root &

URLBASE=$1
shift

HOSTNAME=$(hostname)

# FIXME: xdpyinfo gives too wide dimension with more than
# one display attached.
SIZE=$(xdpyinfo | grep 'dimensions:' | awk '{ print $2 }')
if [ -z "$SIZE" ]; then
  SIZE="800x600"
  echo "!! Unable to autodetect resolution" > /dev/stderr
fi

# open url to conductor
URL="$URLBASE/conductor?resolution=$SIZE&hostname=$HOSTNAME"
# URL="$URLBASE/displayauth?resolution=$SIZE&hostname=$HOSTNAME"

iivari-kiosk "$URL" "$HOSTNAME" "$SIZE" "$@"
