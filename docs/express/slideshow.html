<!DOCTYPE html>  <html> <head>   <title>slideshow.coffee</title>   <meta http-equiv="content-type" content="text/html; charset=UTF-8">   <link rel="stylesheet" media="all" href="docco.css" /> </head> <body>   <div id="container">     <div id="background"></div>            <div id="jump_to">         Jump To &hellip;         <div id="jump_wrapper">           <div id="jump_page">                                           <a class="source" href="jquery.superslides.html">                 jquery.superslides.coffee               </a>                                           <a class="source" href="slideshow.html">                 slideshow.coffee               </a>                                           <a class="source" href="uimessage.html">                 uimessage.coffee               </a>                                           <a class="source" href="index.html">                 index.coffee               </a>                                           <a class="source" href="routes.html">                 routes.coffee               </a>                                           <a class="source" href="slides.html">                 slides.coffee               </a>                        </div>         </div>       </div>          <table cellpadding="0" cellspacing="0">       <thead>         <tr>           <th class="docs">             <h1>               slideshow.coffee             </h1>           </th>           <th class="code">           </th>         </tr>       </thead>       <tbody>                               <tr id="section-1">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-1">&#182;</a>               </div>               <h1>#</h1>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">Copyright</span> <span class="err">©</span> <span class="mi">2012</span> <span class="nx">Opinsys</span> <span class="nx">Oy</span>
            <span class="mi">2012</span> <span class="nx">lamikae</span>

<span class="nx">This</span> <span class="nx">program</span> <span class="o">is</span> <span class="nx">free</span> <span class="nx">software</span><span class="p">;</span> <span class="nx">you</span> <span class="nx">can</span> <span class="nx">redistribute</span> <span class="nx">it</span> <span class="o">and/or</span> <span class="nx">modify</span> <span class="nx">it</span>
<span class="nx">under</span> <span class="nx">the</span> <span class="nx">terms</span> <span class="k">of</span> <span class="nx">the</span> <span class="nx">GNU</span> <span class="nx">General</span> <span class="nx">Public</span> <span class="nx">License</span> <span class="nx">as</span> <span class="nx">published</span> <span class="k">by</span> <span class="nx">the</span>
<span class="nx">Free</span> <span class="nx">Software</span> <span class="nx">Foundation</span><span class="p">;</span> <span class="nx">either</span> <span class="nx">version</span> <span class="mi">2</span> <span class="k">of</span> <span class="nx">the</span> <span class="nx">License</span><span class="p">,</span> <span class="o">or</span> <span class="p">(</span><span class="nx">at</span> <span class="nx">your</span>
<span class="nx">option</span><span class="p">)</span> <span class="nx">any</span> <span class="nx">later</span> <span class="nx">version</span><span class="p">.</span>

<span class="nx">This</span> <span class="nx">program</span> <span class="o">is</span> <span class="nx">distributed</span> <span class="k">in</span> <span class="nx">the</span> <span class="nx">hope</span> <span class="nx">that</span> <span class="nx">it</span> <span class="nx">will</span> <span class="nx">be</span> <span class="nx">useful</span><span class="p">,</span> <span class="nx">but</span>
<span class="nx">WITHOUT</span> <span class="nx">ANY</span> <span class="nx">WARRANTY</span><span class="p">;</span> <span class="nx">without</span> <span class="nx">even</span> <span class="nx">the</span> <span class="nx">implied</span> <span class="nx">warranty</span> <span class="k">of</span>
<span class="nx">MERCHANTABILITY</span> <span class="o">or</span> <span class="nx">FITNESS</span> <span class="nx">FOR</span> <span class="nx">A</span> <span class="nx">PARTICULAR</span> <span class="nx">PURPOSE</span><span class="p">.</span> <span class="nx">See</span> <span class="nx">the</span> <span class="nx">GNU</span> <span class="nx">General</span>
<span class="nx">Public</span> <span class="nx">License</span> <span class="k">for</span> <span class="nx">more</span> <span class="nx">details</span><span class="p">.</span>

<span class="nx">You</span> <span class="nx">should</span> <span class="nx">have</span> <span class="nx">received</span> <span class="nx">a</span> <span class="nx">copy</span> <span class="k">of</span> <span class="nx">the</span> <span class="nx">GNU</span> <span class="nx">General</span> <span class="nx">Public</span> <span class="nx">License</span> <span class="nx">along</span>
<span class="nx">with</span> <span class="k">this</span> <span class="nx">program</span><span class="p">;</span> <span class="k">if</span> <span class="o">not</span><span class="p">,</span> <span class="nx">write</span> <span class="nx">to</span> <span class="nx">the</span> <span class="nx">Free</span> <span class="nx">Software</span> <span class="nx">Foundation</span><span class="p">,</span> <span class="nx">Inc</span><span class="p">.,</span>
<span class="mi">51</span> <span class="nx">Franklin</span> <span class="nx">Street</span><span class="p">,</span> <span class="nx">Fifth</span> <span class="nx">Floor</span><span class="p">,</span> <span class="nx">Boston</span><span class="p">,</span> <span class="nx">MA</span> <span class="mi">02110</span><span class="o">-</span><span class="mi">1301</span><span class="p">,</span> <span class="nx">USA</span><span class="p">.</span></pre></div>             </td>           </tr>                               <tr id="section-2">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-2">&#182;</a>               </div>               <h1>#</h1>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">jQuery</span> <span class="o">-&gt;</span>
    <span class="nx">Iivari</span><span class="p">.</span><span class="nx">init</span><span class="p">();</span>

<span class="nb">window</span><span class="p">.</span><span class="nv">Iivari = </span><span class="p">{</span>
    <span class="nv">Models: </span><span class="p">{},</span>
    <span class="nv">Collections: </span><span class="p">{},</span>
    <span class="nv">Routers: </span><span class="p">{},</span>
    <span class="nv">Views: </span><span class="p">{},</span>
    <span class="nv">init: </span><span class="nf">() -&gt;</span>
        <span class="p">(</span><span class="k">new</span> <span class="nx">Iivari</span><span class="p">.</span><span class="nx">Routers</span><span class="p">.</span><span class="nx">Conductor</span><span class="p">()).</span><span class="nx">start</span><span class="p">();</span>
<span class="p">}</span>

<span class="k">class</span> <span class="nx">Iivari</span><span class="p">.</span><span class="nx">Routers</span><span class="p">.</span><span class="nx">Conductor</span>

    <span class="nb">window</span><span class="p">.</span><span class="nv">display = </span><span class="kc">null</span>     <span class="c1"># backend proxy object for signaling</span>
    <span class="nv">Iivari.displayCtrl = </span><span class="kc">null</span> <span class="c1"># display logic</span>
    <span class="nv">Iivari.onLine = </span><span class="kc">true</span>      <span class="c1"># custom window.navigator.onLine replacement</span>

    <span class="nv">start: </span><span class="o">-&gt;</span>
        <span class="nv">json_url = </span><span class="s">&quot;/slides&quot;</span>
        <span class="nv">data_update_interval = </span><span class="mi">20</span> <span class="o">*</span> <span class="mi">15000</span> <span class="c1"># slides count * slide interval</span>
        <span class="nv">preview = </span><span class="kc">false</span>
        <span class="nv">ctrl_url = </span><span class="kc">null</span>
        <span class="nv">ctrl_update_interval = </span><span class="kc">null</span>
        <span class="nv">cache = </span><span class="kc">false</span>
        <span class="nv">preview = </span><span class="kc">false</span>
        <span class="nv">locale = </span><span class="s">&quot;fi&quot;</span>

        <span class="nv">Iivari.slideshow = </span><span class="k">new</span> <span class="nx">Iivari</span><span class="p">.</span><span class="nx">Views</span><span class="p">.</span><span class="nx">Slideshow</span><span class="p">(</span><span class="nx">json_url</span><span class="p">,</span> <span class="nx">data_update_interval</span><span class="p">,</span> <span class="nx">preview</span><span class="p">,</span> <span class="nx">cache</span><span class="p">)</span>
        <span class="nx">Iivari</span><span class="p">.</span><span class="nx">slideshow</span><span class="p">.</span><span class="nx">start</span><span class="p">()</span></pre></div>             </td>           </tr>                               <tr id="section-3">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-3">&#182;</a>               </div>               <p>TODO: fix offline cache
if (not @preview) and @json<em>url
    # DisplayCtrl runs control timers and handles kiosk backend signaling.
    Iivari.displayCtrl = new Iivari.Models.DisplayCtrl(ctrl</em>url, ctrl<em>update</em>interval, locale)</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="k">class</span> <span class="nx">Iivari</span><span class="p">.</span><span class="nx">Views</span><span class="p">.</span><span class="nx">Slideshow</span>

    <span class="nv">SCREEN_WIDTH = </span><span class="nb">window</span><span class="p">.</span><span class="nx">innerWidth</span>
    <span class="nv">SCREEN_HEIGHT = </span><span class="nb">window</span><span class="p">.</span><span class="nx">innerHeight</span>

    <span class="nv">playing = </span><span class="kc">true</span>
    <span class="nv">fullscreen = </span><span class="kc">false</span></pre></div>             </td>           </tr>                               <tr id="section-4">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-4">&#182;</a>               </div>               <p>animate is an option to use request animation frame
instead of interval-based motionless slide change</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">animate = </span><span class="kc">true</span>

    <span class="nv">constructor: </span><span class="nf">(@json_url, @data_update_interval, @preview, @cache) -&gt;</span>
        <span class="vi">@slideData = </span><span class="kc">null</span></pre></div>             </td>           </tr>                               <tr id="section-5">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-5">&#182;</a>               </div>               <p>hide slide container</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nx">$</span><span class="p">(</span><span class="s">&quot;.slides&quot;</span><span class="p">).</span><span class="nx">hide</span><span class="p">()</span>

        <span class="vi">@notifier_ui = </span><span class="nx">$</span><span class="p">(</span><span class="s">&quot;</span><span class="err">#</span><span class="s">notifications&quot;</span><span class="p">).</span><span class="nx">uimessage</span>
            <span class="nv">container_class: </span><span class="s">&quot;notifications&quot;</span>
            <span class="nv">css:</span>
                <span class="nv">bottom: </span><span class="mi">0</span>

        <span class="vi">@title_ui = </span><span class="nx">$</span><span class="p">(</span><span class="s">&quot;</span><span class="err">#</span><span class="s">slide_title&quot;</span><span class="p">).</span><span class="nx">uimessage</span>
            <span class="nv">container_class: </span><span class="s">&quot;title&quot;</span>
            <span class="nv">css:</span>
                <span class="nv">top: </span><span class="mi">0</span>

        <span class="vi">@help_ui = </span><span class="nx">$</span><span class="p">(</span><span class="s">&quot;</span><span class="err">#</span><span class="s">help&quot;</span><span class="p">).</span><span class="nx">uimessage</span>
            <span class="nv">container_class: </span><span class="s">&quot;help&quot;</span>
            <span class="nv">visible: </span><span class="kc">false</span>
            <span class="nv">css:</span>
                <span class="nv">top: </span><span class="s">&quot;100px&quot;</span>
                <span class="nv">width: </span><span class="s">&quot;92%&quot;</span>
                <span class="s">&quot;min-height&quot;</span><span class="o">:</span> <span class="s">&quot;420px&quot;</span>
            <span class="nv">html: </span><span class="s">&quot;</span>
<span class="s">&lt;div id=&#39;version&#39;&gt;</span><span class="si">#{</span><span class="nb">document</span><span class="p">.</span><span class="nx">title</span><span class="si">}</span><span class="s">&lt;/div&gt;</span>
<span class="s">&lt;article&gt;</span>
<span class="s">&amp;nbsp; -- välilyönti pysäyttää kuvaesityksen&lt;br&gt;</span>
<span class="s">&amp;</span><span class="err">#</span><span class="s">x2194; -- nuolinäppäimillä voi selata edelliseen ja seuraavaan kuvaan&lt;br&gt;</span>
<span class="s">&lt;br&gt;</span>
<span class="s">H -- näytä tämä ohje&lt;br&gt;</span>
<span class="s">F -- piilota otsikko ja näytä vain kuva&lt;br&gt;</span>
<span class="s">     &lt;sub&gt;ajastin tulee esiin 3 sekuntia ennen kuvan vaihtumista&lt;/sub&gt;&lt;br&gt;</span>
<span class="s">R -- arvo uudet kuvat&lt;br&gt;</span>
<span class="s">&lt;/article&gt;</span>
<span class="s">            &quot;</span>


    <span class="nv">start: </span><span class="o">-&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-6">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-6">&#182;</a>               </div>               <p>clear the default background</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nx">$</span><span class="p">(</span><span class="s">&quot;body&quot;</span><span class="p">).</span><span class="nx">css</span>
            <span class="s">&quot;background-image&quot;</span><span class="o">:</span> <span class="s">&quot;null&quot;</span><span class="p">,</span>
            <span class="s">&quot;background&quot;</span><span class="o">:</span> <span class="s">&quot;black&quot;</span><span class="p">,</span></pre></div>             </td>           </tr>                               <tr id="section-7">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-7">&#182;</a>               </div>               <p>start superslides after receiving the first slide batch</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nv">promise = </span><span class="nx">@updateSlideData</span><span class="p">()</span>
        <span class="nx">promise</span><span class="p">.</span><span class="nx">done</span> <span class="o">=&gt;</span>
            <span class="nx">@initSlideshow</span><span class="p">()</span>
        <span class="nx">promise</span><span class="p">.</span><span class="nx">fail</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="o">=&gt;</span>
            <span class="nx">console</span><span class="p">.</span><span class="nx">log</span> <span class="s">&quot;failed to load slides, try again...&quot;</span>
            <span class="nx">setTimeout</span> <span class="nx">@start</span><span class="p">,</span> <span class="mi">5000</span></pre></div>             </td>           </tr>                               <tr id="section-8">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-8">&#182;</a>               </div>               <p>start slide poll</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="k">if</span> <span class="p">(</span><span class="o">not</span> <span class="nx">@preview</span><span class="p">)</span> <span class="o">and</span> <span class="nx">@json_url</span> <span class="o">and</span> <span class="nx">@data_update_interval</span>
            <span class="nx">setInterval</span> <span class="nx">@updateSlideData</span><span class="p">,</span> <span class="nx">@data_update_interval</span>

        <span class="nb">document</span><span class="p">.</span><span class="nv">onkeydown = </span><span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="o">=&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-9">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-9">&#182;</a>               </div>               <p>do not intercept Ctrl^ commands</p>             </td>             <td class="code">               <div class="highlight"><pre>            <span class="nv">ctrlDown = </span><span class="nx">event</span><span class="p">.</span><span class="nx">ctrlKey</span> <span class="o">||</span> <span class="nx">event</span><span class="p">.</span><span class="nx">metaKey</span> <span class="c1"># Mac support</span>
            <span class="k">if</span> <span class="nx">ctrlDown</span></pre></div>             </td>           </tr>                               <tr id="section-10">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-10">&#182;</a>               </div>               <p>execute default</p>             </td>             <td class="code">               <div class="highlight"><pre>                <span class="k">return</span>

            <span class="nv">c = </span><span class="nx">event</span><span class="p">.</span><span class="nx">keyCode</span></pre></div>             </td>           </tr>                               <tr id="section-11">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-11">&#182;</a>               </div>               <p>console.log c</p>             </td>             <td class="code">               <div class="highlight"><pre>            <span class="k">switch</span> <span class="nx">c</span></pre></div>             </td>           </tr>                               <tr id="section-12">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-12">&#182;</a>               </div>               <p>32, space -> toggle pause</p>             </td>             <td class="code">               <div class="highlight"><pre>                <span class="k">when</span> <span class="mi">32</span>
                    <span class="nx">@togglePause</span><span class="p">()</span>
                    <span class="nx">event</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">()</span></pre></div>             </td>           </tr>                               <tr id="section-13">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-13">&#182;</a>               </div>               <p>37, left arrow -> prev</p>             </td>             <td class="code">               <div class="highlight"><pre>                <span class="k">when</span> <span class="mi">37</span>
                    <span class="nx">$</span><span class="p">(</span><span class="s">&quot;</span><span class="err">#</span><span class="s">slideshow&quot;</span><span class="p">).</span><span class="nx">superslides</span><span class="p">(</span><span class="s">&quot;prev&quot;</span><span class="p">)</span>
                    <span class="nx">@togglePause</span><span class="p">()</span> <span class="k">if</span> <span class="nx">playing</span>
                    <span class="nx">event</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">()</span></pre></div>             </td>           </tr>                               <tr id="section-14">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-14">&#182;</a>               </div>               <p>39, right arrow -> next</p>             </td>             <td class="code">               <div class="highlight"><pre>                <span class="k">when</span> <span class="mi">39</span>
                    <span class="nx">$</span><span class="p">(</span><span class="s">&quot;</span><span class="err">#</span><span class="s">slideshow&quot;</span><span class="p">).</span><span class="nx">superslides</span><span class="p">(</span><span class="s">&quot;next&quot;</span><span class="p">)</span>
                    <span class="nx">@togglePause</span><span class="p">()</span> <span class="k">if</span> <span class="nx">playing</span>
                    <span class="nx">event</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">()</span></pre></div>             </td>           </tr>                               <tr id="section-15">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-15">&#182;</a>               </div>               <p>70, f -> toggle fullscreen</p>             </td>             <td class="code">               <div class="highlight"><pre>                <span class="k">when</span> <span class="mi">70</span>
                    <span class="nx">event</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">()</span>
                    <span class="nx">@toggleFullscreen</span><span class="p">()</span></pre></div>             </td>           </tr>                               <tr id="section-16">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-16">&#182;</a>               </div>               <p>72, h -> toggle help</p>             </td>             <td class="code">               <div class="highlight"><pre>                <span class="k">when</span> <span class="mi">72</span>
                    <span class="nx">event</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">()</span>
                    <span class="k">try</span>
                        <span class="nx">@help_ui</span><span class="p">.</span><span class="nx">toggle</span><span class="p">()</span></pre></div>             </td>           </tr>                               <tr id="section-17">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-17">&#182;</a>               </div>               <p>82, r -> load new slides</p>             </td>             <td class="code">               <div class="highlight"><pre>                <span class="k">when</span> <span class="mi">82</span>
                    <span class="nx">@updateSlideData</span><span class="p">(</span><span class="kc">true</span><span class="p">)</span>
                    <span class="nx">event</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">()</span>

        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span> <span class="s">&quot;Info: express slideshow started&quot;</span>


    <span class="nv">toggleFullscreen: </span><span class="o">=&gt;</span>
        <span class="k">if</span> <span class="nx">fullscreen</span></pre></div>             </td>           </tr>                               <tr id="section-18">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-18">&#182;</a>               </div>               <p>exit fullscreen, show elements</p>             </td>             <td class="code">               <div class="highlight"><pre>            <span class="nv">fullscreen = </span><span class="kc">false</span>
            <span class="nx">$</span><span class="p">(</span><span class="s">&quot;</span><span class="err">#</span><span class="s">next-slide-delay&quot;</span><span class="p">).</span><span class="nx">fadeIn</span><span class="p">(</span><span class="s">&quot;fast&quot;</span><span class="p">)</span>
            <span class="nx">$</span><span class="p">(</span><span class="s">&quot;</span><span class="err">#</span><span class="s">state&quot;</span><span class="p">).</span><span class="nx">fadeIn</span><span class="p">(</span><span class="s">&quot;fast&quot;</span><span class="p">)</span>
            <span class="k">try</span>
                <span class="nx">@title_ui</span><span class="p">.</span><span class="nx">unhide</span><span class="p">()</span>
                <span class="nx">@notifier_ui</span><span class="p">.</span><span class="nx">unhide</span><span class="p">()</span>
        <span class="k">else</span></pre></div>             </td>           </tr>                               <tr id="section-19">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-19">&#182;</a>               </div>               <p>enter fullscreen, hide elements</p>             </td>             <td class="code">               <div class="highlight"><pre>            <span class="nv">fullscreen = </span><span class="kc">true</span>
            <span class="nx">$</span><span class="p">(</span><span class="s">&quot;</span><span class="err">#</span><span class="s">next-slide-delay&quot;</span><span class="p">).</span><span class="nx">fadeOut</span><span class="p">(</span><span class="s">&quot;fast&quot;</span><span class="p">)</span>
            <span class="nx">$</span><span class="p">(</span><span class="s">&quot;</span><span class="err">#</span><span class="s">state&quot;</span><span class="p">).</span><span class="nx">fadeOut</span><span class="p">(</span><span class="s">&quot;fast&quot;</span><span class="p">)</span>
            <span class="k">try</span>
                <span class="nx">@title_ui</span><span class="p">.</span><span class="nx">hide</span><span class="p">()</span>
                <span class="nx">@notifier_ui</span><span class="p">.</span><span class="nx">hide</span><span class="p">()</span>


    <span class="nv">togglePause: </span><span class="o">=&gt;</span>
        <span class="k">if</span> <span class="nx">playing</span>
            <span class="nv">playing = </span><span class="kc">false</span>
            <span class="nx">@abortNextSlide</span><span class="p">()</span>
            <span class="nx">$</span><span class="p">(</span><span class="s">&quot;</span><span class="err">#</span><span class="s">state&quot;</span><span class="p">).</span><span class="nx">text</span><span class="p">(</span><span class="s">&quot;||&quot;</span><span class="p">).</span><span class="nx">addClass</span><span class="p">(</span><span class="s">&quot;paused&quot;</span><span class="p">)</span>
            <span class="nx">console</span><span class="p">.</span><span class="nx">log</span> <span class="s">&quot;Slideshow paused&quot;</span>
        <span class="k">else</span>
            <span class="nv">playing = </span><span class="kc">true</span></pre></div>             </td>           </tr>                               <tr id="section-20">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-20">&#182;</a>               </div>               <p>use request animation frame or timeout?</p>             </td>             <td class="code">               <div class="highlight"><pre>            <span class="k">if</span> <span class="nx">animate</span>
                <span class="vi">@nextSlideDeferred = </span><span class="nx">@slideDelayAnimate</span> <span class="p">(</span><span class="nb">Date</span><span class="p">.</span><span class="nx">now</span><span class="p">()</span> <span class="o">-</span> <span class="nx">@current_dt</span><span class="p">),</span> <span class="nx">@current_delay</span>
            <span class="k">else</span>
                <span class="vi">@nextSlideTimeout = </span><span class="nx">@slideDelay</span><span class="p">()</span>
            <span class="nx">$</span><span class="p">(</span><span class="s">&quot;</span><span class="err">#</span><span class="s">state&quot;</span><span class="p">).</span><span class="nx">text</span><span class="p">(</span><span class="s">&quot;&quot;</span><span class="p">).</span><span class="nx">removeClass</span><span class="p">(</span><span class="s">&quot;paused&quot;</span><span class="p">)</span>
            <span class="nx">console</span><span class="p">.</span><span class="nx">log</span> <span class="s">&quot;Slideshow playing&quot;</span>


    <span class="nv">abortNextSlide: </span><span class="o">=&gt;</span>
        <span class="k">if</span> <span class="nx">@nextSlideTimeout</span>
            <span class="nx">clearTimeout</span> <span class="nx">@nextSlideTimeout</span>
        <span class="k">if</span> <span class="nx">@nextSlideDeferred</span>
            <span class="nx">@nextSlideDeferred</span><span class="p">.</span><span class="nx">reject</span><span class="p">()</span></pre></div>             </td>           </tr>                               <tr id="section-21">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-21">&#182;</a>               </div>               <p>render slides using Transparency.js</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">renderSlides: </span><span class="o">=&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-22">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-22">&#182;</a>               </div>               <p>stop any other active slide animation deffereds</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nx">@abortNextSlide</span><span class="p">()</span></pre></div>             </td>           </tr>                               <tr id="section-23">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-23">&#182;</a>               </div>               <p>clear current slide abruptly</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nx">$</span><span class="p">(</span><span class="s">&quot;.slides&quot;</span><span class="p">).</span><span class="nx">html</span><span class="p">()</span></pre></div>             </td>           </tr>                               <tr id="section-24">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-24">&#182;</a>               </div>               <p>render new slideset
(@slide_html is a property of each @slideData)</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nx">$</span><span class="p">(</span><span class="s">&quot;.slides&quot;</span><span class="p">).</span><span class="nx">render</span><span class="p">(</span>
            <span class="nx">@slideData</span><span class="p">,</span>
            <span class="p">{</span><span class="nv">slide: </span><span class="o">-&gt;</span> <span class="nv">html: </span><span class="nx">@slide_html</span><span class="p">})</span>
        <span class="nx">$</span><span class="p">(</span><span class="s">&quot;.fullimg img&quot;</span><span class="p">).</span><span class="nx">css</span>
            <span class="nv">width: </span><span class="s">&quot;auto&quot;</span><span class="p">,</span>
            <span class="nv">height: </span><span class="s">&quot;</span><span class="si">#{</span><span class="nx">SCREEN_HEIGHT</span><span class="si">}</span><span class="s">px&quot;</span>
        <span class="nx">$</span><span class="p">(</span><span class="s">&quot;.slides&quot;</span><span class="p">).</span><span class="nx">trigger</span><span class="p">(</span><span class="s">&quot;slides.animated&quot;</span><span class="p">)</span>


    <span class="nv">renderCurrent: </span><span class="o">=&gt;</span>
        <span class="k">try</span>
            <span class="nv">slide_nr = </span><span class="nx">$</span><span class="p">(</span><span class="s">&#39;#slideshow&#39;</span><span class="p">).</span><span class="nx">superslides</span><span class="p">(</span><span class="s">&quot;current&quot;</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-25">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-25">&#182;</a>               </div>               <p>console.log "Slide nr #{slide<em>nr}"
console.log @slideData[slide</em>nr]</p>             </td>             <td class="code">               <div class="highlight"><pre>            <span class="k">try</span></pre></div>             </td>           </tr>                               <tr id="section-26">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-26">&#182;</a>               </div>               <p>trust dom slide indexing</p>             </td>             <td class="code">               <div class="highlight"><pre>                <span class="nv">title_el = </span><span class="nx">$</span><span class="p">(</span><span class="s">&quot;.title_container&quot;</span><span class="p">)[</span><span class="nx">slide_nr</span><span class="p">]</span>
                <span class="nv">title_text = </span><span class="nx">$</span><span class="p">(</span><span class="nx">title_el</span><span class="p">).</span><span class="nx">text</span><span class="p">().</span><span class="nx">trim</span><span class="p">()</span></pre></div>             </td>           </tr>                               <tr id="section-27">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-27">&#182;</a>               </div>               <p>..or use original?
console.log @slideData[slide<em>nr].slide</em>html</p>             </td>             <td class="code">               <div class="highlight"><pre>                <span class="nx">@title_ui</span><span class="p">.</span><span class="nx">show</span> <span class="nx">title_text</span><span class="p">,</span> <span class="kc">false</span>

            <span class="nx">@abortNextSlide</span><span class="p">()</span>

            <span class="nv">delay = </span><span class="nx">@slideData</span><span class="p">[</span><span class="nx">slide_nr</span><span class="p">].</span><span class="nx">slide_delay</span>
            <span class="k">if</span> <span class="nx">delay</span></pre></div>             </td>           </tr>                               <tr id="section-28">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-28">&#182;</a>               </div>               <p>this delay is in seconds, convert to ms</p>             </td>             <td class="code">               <div class="highlight"><pre>                <span class="vi">@current_delay = </span><span class="nx">delay</span> <span class="o">*</span> <span class="mi">1000</span></pre></div>             </td>           </tr>                               <tr id="section-29">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-29">&#182;</a>               </div>               <p>console.log "slide delay: #{@current_delay}"</p>             </td>             <td class="code">               <div class="highlight"><pre>            <span class="k">else</span></pre></div>             </td>           </tr>                               <tr id="section-30">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-30">&#182;</a>               </div>               <p>default, 10 sec</p>             </td>             <td class="code">               <div class="highlight"><pre>                <span class="vi">@current_delay = </span><span class="mi">10000</span>

            <span class="nv">progress_text = </span><span class="s">&quot;</span><span class="si">#{</span><span class="nx">slide_nr</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s"> / </span><span class="si">#{</span><span class="nx">_</span><span class="p">.</span><span class="nx">size</span> <span class="nx">@slideData</span><span class="si">}</span><span class="s">&quot;</span>
            <span class="k">if</span> <span class="nx">animate</span>
                <span class="nv">wrapper = </span><span class="nx">$</span><span class="p">(</span><span class="s">&quot;</span><span class="err">#</span><span class="s">next-slide-delay&quot;</span><span class="p">)</span>
                <span class="nv">knob = </span><span class="s">&#39;&lt;input type=&quot;text&quot; value=&quot;0&quot; class=&quot;dial&quot;&gt;&#39;</span>
                <span class="nx">$</span><span class="p">(</span><span class="nx">wrapper</span><span class="p">)</span>
                    <span class="p">.</span><span class="nx">html</span><span class="p">(</span><span class="s">&quot;&quot;</span><span class="p">)</span>
                    <span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="nx">knob</span><span class="p">)</span>
                <span class="nx">$</span><span class="p">(</span><span class="s">&quot;</span><span class="err">#</span><span class="s">next-slide-delay .dial&quot;</span><span class="p">).</span><span class="nx">knob</span>
                    <span class="nv">readonly: </span><span class="kc">true</span>
                    <span class="nv">skin: </span><span class="s">&quot;tron&quot;</span>
                    <span class="nv">fgColor: </span><span class="s">&quot;</span><span class="err">#</span><span class="s">efefef&quot;</span>
                    <span class="nv">bgColor: </span><span class="s">&quot;</span><span class="err">#</span><span class="s">222222&quot;</span>
                    <span class="nv">thickness: </span><span class="s">&quot;.2&quot;</span>
                    <span class="nv">displayPrevious: </span><span class="kc">true</span>
                    <span class="nv">width: </span><span class="mi">180</span>
                    <span class="nv">max: </span><span class="nx">@current_delay</span>
                    <span class="nv">dialText: </span><span class="nx">progress_text</span>
                    <span class="nv">val: </span><span class="mi">0</span>
                <span class="vi">@current_dt = </span><span class="mi">0</span>
                <span class="nx">$</span><span class="p">(</span><span class="s">&quot;</span><span class="err">#</span><span class="s">next-slide-delay .dial&quot;</span><span class="p">)</span>
                    <span class="p">.</span><span class="nx">val</span><span class="p">(</span><span class="nx">@current_dt</span><span class="p">)</span>
                    <span class="p">.</span><span class="nx">trigger</span><span class="p">(</span><span class="s">&quot;change&quot;</span><span class="p">)</span>
            <span class="k">else</span>
                <span class="nv">wrapper = </span><span class="nx">$</span><span class="p">(</span><span class="s">&quot;</span><span class="err">#</span><span class="s">next-slide-delay&quot;</span><span class="p">)</span>
                <span class="nx">wrapper</span>
                    <span class="p">.</span><span class="nx">text</span><span class="p">(</span><span class="nx">progress_text</span><span class="p">)</span>
                    <span class="p">.</span><span class="nx">css</span>
                        <span class="s">&quot;font-size&quot;</span><span class="o">:</span> <span class="s">&quot;3em&quot;</span>

                <span class="nx">$</span><span class="p">(</span><span class="s">&quot;</span><span class="err">#</span><span class="s">state&quot;</span><span class="p">).</span><span class="nx">css</span>
                    <span class="nv">bottom: </span><span class="s">&quot;2em&quot;</span>

            <span class="k">if</span> <span class="nx">playing</span></pre></div>             </td>           </tr>                               <tr id="section-31">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-31">&#182;</a>               </div>               <p>use request animation frame or timeout?</p>             </td>             <td class="code">               <div class="highlight"><pre>                <span class="k">if</span> <span class="nx">animate</span>
                    <span class="vi">@nextSlideDeferred = </span><span class="nx">@slideDelayAnimate</span><span class="p">(</span><span class="nb">Date</span><span class="p">.</span><span class="nx">now</span><span class="p">(),</span> <span class="nx">@current_delay</span><span class="p">)</span>
                <span class="k">else</span>
                    <span class="vi">@nextSlideTimeout = </span><span class="nx">@slideDelay</span><span class="p">()</span>
                <span class="nx">$</span><span class="p">(</span><span class="s">&quot;</span><span class="err">#</span><span class="s">state&quot;</span><span class="p">).</span><span class="nx">text</span><span class="p">(</span><span class="s">&quot;&quot;</span><span class="p">).</span><span class="nx">removeClass</span><span class="p">(</span><span class="s">&quot;paused&quot;</span><span class="p">)</span>

            <span class="k">if</span> <span class="nx">fullscreen</span></pre></div>             </td>           </tr>                               <tr id="section-32">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-32">&#182;</a>               </div>               <p>hide previous image timeout warning</p>             </td>             <td class="code">               <div class="highlight"><pre>                <span class="nx">$</span><span class="p">(</span><span class="s">&quot;</span><span class="err">#</span><span class="s">next-slide-delay&quot;</span><span class="p">).</span><span class="nx">fadeOut</span><span class="p">()</span>

        <span class="k">catch</span> <span class="nx">err</span>
            <span class="nx">console</span><span class="p">.</span><span class="nx">log</span> <span class="s">&quot;Failed to lookup slide from index </span><span class="si">#{</span><span class="nx">slide_nr</span><span class="si">}</span><span class="s">&quot;</span>
            <span class="nx">console</span><span class="p">.</span><span class="nx">log</span> <span class="nx">err</span>


    <span class="nv">initSlideshow: </span><span class="o">=&gt;</span>
        <span class="nx">$</span><span class="p">(</span><span class="s">&#39;#slideshow&#39;</span><span class="p">).</span><span class="nx">superslides</span>
            <span class="nv">play: </span><span class="kc">false</span>
            <span class="nv">container_class: </span><span class="s">&quot;slides&quot;</span>

        <span class="nx">$</span><span class="p">(</span><span class="s">&quot;body&quot;</span><span class="p">).</span><span class="kc">on</span> <span class="s">&quot;slides.initialized&quot;</span><span class="p">,</span> <span class="s">&quot;</span><span class="err">#</span><span class="s">slideshow&quot;</span><span class="p">,</span> <span class="o">=&gt;</span>
            <span class="nx">console</span><span class="p">.</span><span class="nx">log</span> <span class="s">&#39;Slideshow initialized!&#39;</span>
            <span class="nx">$</span><span class="p">(</span><span class="s">&quot;.slides&quot;</span><span class="p">).</span><span class="nx">bind</span><span class="p">(</span>
                <span class="s">&quot;slides.animated&quot;</span><span class="p">,</span> <span class="nx">@renderCurrent</span>
            <span class="p">).</span><span class="nx">fadeIn</span><span class="p">(</span><span class="mi">5000</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-33">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-33">&#182;</a>               </div>               <p>Change slide after a timeout.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">slideDelay: </span><span class="p">(</span><span class="nx">delay</span><span class="p">)</span> <span class="o">=&gt;</span>
        <span class="k">return</span> <span class="nx">unless</span> <span class="nx">playing</span>
        <span class="nx">delay</span> <span class="o">?=</span> <span class="mi">10000</span>
        <span class="k">return</span> <span class="nx">setTimeout</span> <span class="o">=&gt;</span>
            <span class="nx">$</span><span class="p">(</span><span class="s">&quot;</span><span class="err">#</span><span class="s">slideshow&quot;</span><span class="p">).</span><span class="nx">superslides</span><span class="p">(</span><span class="s">&quot;next&quot;</span><span class="p">)</span>
        <span class="p">,</span> <span class="nx">delay</span></pre></div>             </td>           </tr>                               <tr id="section-34">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-34">&#182;</a>               </div>               <p>Change slide within animation frame, the delay is shown on jQuery.Knob dial.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">slideDelayAnimate: </span><span class="p">(</span><span class="nx">t0</span><span class="p">,</span> <span class="nx">delay</span><span class="p">,</span> <span class="nx">deferred</span><span class="p">)</span> <span class="o">=&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-35">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-35">&#182;</a>               </div>               <p>Deferred acts as "clearTimeout" to this RequestAnimationFrame
when its state is either resolved or rejected.</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nx">deferred</span> <span class="o">?=</span> <span class="k">new</span> <span class="nx">$</span><span class="p">.</span><span class="nx">Deferred</span><span class="p">()</span>
        <span class="k">return</span> <span class="nx">deferred</span> <span class="k">if</span> <span class="nx">deferred</span><span class="p">.</span><span class="nx">state</span><span class="p">()</span> <span class="o">!=</span> <span class="s">&quot;pending&quot;</span>
        <span class="nx">delay</span> <span class="o">?=</span> <span class="mi">30000</span>
        <span class="nx">t0</span> <span class="o">?=</span> <span class="nb">Date</span><span class="p">.</span><span class="nx">now</span><span class="p">()</span>
        <span class="nv">t1 = </span><span class="nb">Date</span><span class="p">.</span><span class="nx">now</span><span class="p">()</span>
        <span class="vi">@current_dt = </span><span class="nx">t1</span> <span class="o">-</span> <span class="nx">t0</span>
        <span class="vi">@current_delay = </span><span class="nx">delay</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">@current_dt</span><span class="p">)</span> <span class="o">&lt;</span> <span class="nx">delay</span></pre></div>             </td>           </tr>                               <tr id="section-36">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-36">&#182;</a>               </div>               <p>continue</p>             </td>             <td class="code">               <div class="highlight"><pre>            <span class="nx">$</span><span class="p">(</span><span class="s">&quot;</span><span class="err">#</span><span class="s">next-slide-delay .dial&quot;</span><span class="p">)</span>
                <span class="p">.</span><span class="nx">val</span><span class="p">(</span><span class="nx">@current_dt</span><span class="p">)</span>
                <span class="p">.</span><span class="nx">trigger</span><span class="p">(</span><span class="s">&quot;change&quot;</span><span class="p">)</span>
            <span class="nx">unless</span> <span class="nx">playing</span>
                <span class="nx">deferred</span><span class="p">.</span><span class="nx">reject</span><span class="p">()</span>
                <span class="k">return</span> <span class="nx">deferred</span></pre></div>             </td>           </tr>                               <tr id="section-37">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-37">&#182;</a>               </div>               <p>in fullscreen mode, alert if time is running out</p>             </td>             <td class="code">               <div class="highlight"><pre>            <span class="nv">alert_dt = </span><span class="mi">3000</span>
            <span class="k">if</span> <span class="nx">fullscreen</span> <span class="o">and</span> <span class="p">((</span><span class="nx">delay</span> <span class="o">-</span> <span class="nx">@current_dt</span><span class="p">)</span> <span class="o">&lt;</span> <span class="nx">alert_dt</span><span class="p">)</span>
                <span class="nx">$</span><span class="p">(</span><span class="s">&quot;</span><span class="err">#</span><span class="s">next-slide-delay&quot;</span><span class="p">).</span><span class="nx">fadeIn</span><span class="p">()</span></pre></div>             </td>           </tr>                               <tr id="section-38">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-38">&#182;</a>               </div>               <p>animate</p>             </td>             <td class="code">               <div class="highlight"><pre>            <span class="nx">requestAnimationFrame</span> <span class="o">=&gt;</span> <span class="nx">@slideDelayAnimate</span><span class="p">(</span><span class="nx">t0</span><span class="p">,</span> <span class="nx">delay</span><span class="p">,</span> <span class="nx">deferred</span><span class="p">)</span>
        <span class="k">else</span></pre></div>             </td>           </tr>                               <tr id="section-39">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-39">&#182;</a>               </div>               <p>timeout</p>             </td>             <td class="code">               <div class="highlight"><pre>            <span class="nx">$</span><span class="p">(</span><span class="s">&quot;</span><span class="err">#</span><span class="s">next-slide-delay .dial&quot;</span><span class="p">)</span>
                <span class="p">.</span><span class="nx">val</span><span class="p">(</span><span class="nx">delay</span><span class="p">)</span>
                <span class="p">.</span><span class="nx">trigger</span><span class="p">(</span><span class="s">&quot;change&quot;</span><span class="p">)</span>
            <span class="nx">$</span><span class="p">(</span><span class="s">&quot;</span><span class="err">#</span><span class="s">slideshow&quot;</span><span class="p">).</span><span class="nx">superslides</span><span class="p">(</span><span class="s">&quot;next&quot;</span><span class="p">)</span>
            <span class="nx">deferred</span><span class="p">.</span><span class="nx">resolve</span><span class="p">()</span>
        <span class="k">return</span> <span class="nx">deferred</span>


    <span class="nv">updateSlideData: </span><span class="p">(</span><span class="nx">force</span><span class="p">)</span> <span class="o">=&gt;</span>
        <span class="nv">deferred = </span><span class="k">new</span> <span class="nx">$</span><span class="p">.</span><span class="nx">Deferred</span><span class="p">()</span>
        <span class="nv">promise = </span><span class="nx">deferred</span><span class="p">.</span><span class="nx">promise</span><span class="p">()</span>
        <span class="nx">force</span> <span class="o">?=</span> <span class="kc">false</span></pre></div>             </td>           </tr>                               <tr id="section-40">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-40">&#182;</a>               </div>               <p>refuse to fetch new slides in pause mode</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nx">unless</span> <span class="nx">playing</span> <span class="o">or</span> <span class="nx">force</span>
            <span class="nx">deferred</span><span class="p">.</span><span class="nx">reject</span><span class="p">()</span>
            <span class="k">return</span> <span class="nx">promise</span>
        <span class="k">try</span>
            <span class="nx">@notifier_ui</span><span class="p">.</span><span class="nx">show</span> <span class="s">&quot;Arvotaan uusia kuvia..&quot;</span>
        <span class="nx">promise</span><span class="p">.</span><span class="nx">done</span> <span class="o">=&gt;</span>
            <span class="k">try</span>
                <span class="nx">@notifier_ui</span><span class="p">.</span><span class="nx">clear</span><span class="p">()</span>
        <span class="nx">promise</span><span class="p">.</span><span class="nx">fail</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="o">=&gt;</span>
            <span class="nx">console</span><span class="p">.</span><span class="nx">log</span> <span class="nx">err</span>
            <span class="k">try</span>
                <span class="nx">@notifier_ui</span><span class="p">.</span><span class="nx">show</span> <span class="s">&quot;Taustaprosessiin ei saada yhteyttä&quot;</span><span class="p">,</span> <span class="kc">false</span>

        <span class="k">if</span> <span class="nx">@cache</span></pre></div>             </td>           </tr>                               <tr id="section-41">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-41">&#182;</a>               </div>               <p>jquery-offline handles transport errors
NOTE: if offline (no network), and even if server is localhost, json data is not requested!</p>             </td>             <td class="code">               <div class="highlight"><pre>            <span class="nx">$</span><span class="p">.</span><span class="nx">retrieveJSON</span> <span class="nx">@json_url</span><span class="p">,</span> <span class="p">(</span><span class="nx">json</span><span class="p">,</span> <span class="nx">status</span><span class="p">,</span> <span class="nx">attributes</span><span class="p">)</span> <span class="o">=&gt;</span>
                <span class="nx">unless</span> <span class="nx">json</span>
                    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span> <span class="s">&quot;No slide data received!&quot;</span>
                    <span class="nx">deferred</span><span class="p">.</span><span class="nx">reject</span><span class="p">()</span>
                    <span class="k">return</span>

                <span class="k">if</span> <span class="o">not</span> <span class="nx">@slideData</span> <span class="o">or</span> <span class="nx">status</span> <span class="o">!=</span> <span class="s">&quot;notmodified&quot;</span>
                    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span> <span class="s">&quot;received </span><span class="si">#{</span><span class="nx">json</span><span class="p">.</span><span class="nx">length</span><span class="si">}</span><span class="s"> slides&quot;</span>
                    <span class="vi">@slideData = </span><span class="nx">json</span>
                    <span class="nx">@renderSlides</span><span class="p">()</span>
                    <span class="k">try</span>
                        <span class="nb">window</span><span class="p">.</span><span class="nx">applicationCache</span><span class="p">.</span><span class="nx">update</span><span class="p">()</span>
                <span class="nx">deferred</span><span class="p">.</span><span class="nx">resolve</span><span class="p">()</span>

        <span class="k">else</span>
            <span class="nx">console</span><span class="p">.</span><span class="nx">log</span> <span class="s">&quot;GET </span><span class="si">#{</span><span class="nx">@json_url</span><span class="si">}</span><span class="s">&quot;</span>
            <span class="nx">$</span><span class="p">.</span><span class="nx">ajax</span>
                <span class="nv">url: </span><span class="nx">@json_url</span><span class="p">,</span>
                <span class="nv">dataType: </span><span class="s">&#39;json&#39;</span><span class="p">,</span>
                <span class="nv">cache: </span><span class="kc">false</span><span class="p">,</span>
                <span class="nv">timeout: </span><span class="mi">300000</span><span class="p">,</span>
                <span class="nv">success: </span><span class="p">(</span><span class="nx">data</span><span class="p">,</span> <span class="nx">textStatus</span><span class="p">,</span> <span class="nx">jqXHR</span><span class="p">)</span> <span class="o">=&gt;</span>
                    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s">&quot;Info: received </span><span class="si">#{</span><span class="nx">data</span><span class="p">.</span><span class="nx">length</span><span class="si">}</span><span class="s"> images from </span><span class="si">#{</span><span class="nx">@json_url</span><span class="si">}</span><span class="s">&quot;</span><span class="p">)</span>
                    <span class="vi">@slideData = </span><span class="nx">data</span>
                    <span class="nx">@renderSlides</span><span class="p">()</span>
                    <span class="nx">deferred</span><span class="p">.</span><span class="nx">resolve</span><span class="p">()</span>

                <span class="nv">error: </span><span class="nf">(jqXHR, textStatus, errorThrown) -&gt;</span>
                    <span class="nx">deferred</span><span class="p">.</span><span class="nx">reject</span><span class="p">(</span><span class="s">&quot;</span><span class="si">#{</span><span class="nx">textStatus</span><span class="si">}</span><span class="s">: </span><span class="si">#{</span><span class="nx">errorThrown</span><span class="si">}</span><span class="s">&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="nx">promise</span>

</pre></div>             </td>           </tr>                </tbody>     </table>   </div> </body> </html> 